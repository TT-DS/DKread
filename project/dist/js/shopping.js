"use strict";require(["config"],function(){require(["jquery","template","header","footer","lunbo","cookie"],function(i,a){new Promise(function(e,t){i("header").load("/html/component/header.html",function(){e()}),i(".DK-seek").load("/html/component/DK-seek.html",function(){}),i(".DK-nav").load("/html/component/DK-nav.html",function(){}),i("footer").load("/html/component/footer.html",function(){})}).then(function(){i.cookie("name")&&(i("#DK-id").html("<a href='/index.html' class='DK-username'>"+i.cookie("name")+"</a>"),i(".hi-DK").load("/html/component/hi-DK.html")),i(".DK-username").click(function(){i.cookie("name","",{expires:-1})})}).then(function(){i.cookie("name")?i.ajax({url:"http://localhost/DK-read/api/shopping.php",method:"POST",dataType:"json",success:function(e){var t=a("banner-img",{product:e});i(".shopping-ul").html(t),i(".delete").click(function(){var a=i(this),l=i(this).text();i(".shopping-affirm1").fadeIn("fast").css("display","block"),i("#del-btn1").click(function(){i(".shopping-affirm1").fadeIn("fast").css("display","none")}),i("#del-btn").click(function(){var e=l;console.log(e);var t=e.split("="),n={};n[t[0]]=t[1],console.log(n),i.ajax({url:"http://localhost/DK-read/api/delete.php",data:n,method:"POST",dataType:"json",success:function(e){1===e.code&&(a.parent().parent().remove(),i(".shopping-affirm1").fadeIn("fast").css("display","none"))}})})});var c=0,n=0;i("#checkbox-all").click(function(){c=0,1==this.checked?(i(".checkbox").prop("checked",!0),console.log(i(".DK-list-price").length),i(".DK-list-price").each(function(){var e=i(this).parent().nextAll().find(".num-sum").val(),t=i(this).text();n+=Number(e),c+=Number(t)*Number(e)}),i(".book-all").html(n),i(".all-price").html(c)):(n=c=0,i(".checkbox").prop("checked",!1),i(".all-price").html(c),i(".book-all").html(n))});i(".checkbox").each(function(){i(this).click(function(){if(1==this.checked){var e=i(this).parent().nextAll().find(".DK-list-price").text(),t=i(this).parent().nextAll().find(".num-sum").val();c+=Number(e)*Number(t),i(".all-price").html(c),i(".checkbox").length==i(".checkbox:checked").length&&i("#checkbox-all").prop("checked",!0)}else{i("#checkbox-all").prop("checked",!1);e=i(this).parent().nextAll().find(".DK-list-price").text(),t=i(this).parent().nextAll().find(".num-sum").val();c-=Number(e)*Number(t),i(".all-price").html(c)}})}),i(".num-add").click(function(){var e=i(this).parent().parent().parent().find(".delete-span").text().split("="),t={};if(t[e[0]]=e[1],i.ajax({url:"http://localhost/DK-read/api/num-add.php",data:t,method:"POST",dataType:"json",success:function(e){e.code}}),i(this).parent().parent().parent().find(".checkbox").get(0).checked){var n=i(this).parent().parent().find(".DK-list-price").text();c+=Number(n),i(".all-price").html(c)}var a=i(this).prev(".num-sum").val();a=Number(a)+1,i(this).prev(".num-sum").val(a)}),i(".num-sub").click(function(){var e=i(this).next(".num-sum").val();if(1==e)i(this).next(".num-sum").val(1);else{var t=i(this).parent().parent().parent().find(".delete-span").text();console.log(t);var n=t.split("="),a={};if(a[n[0]]=n[1],console.log(a),i.ajax({url:"http://localhost/DK-read/api/num-sub.php",data:a,method:"POST",dataType:"json",success:function(e){e.code}}),i(this).parent().parent().parent().find(".checkbox").get(0).checked){var l=i(this).parent().parent().find(".DK-list-price").text();c-=Number(l),i(".all-price").html(c)}e=Number(e)-1,i(this).next(".num-sum").val(e)}})}}):i(".shopping-ul").html("<li class='login-shopping'><a href='login.html'>请登录查看购物车！</a></li>")}).then(function(){})})});